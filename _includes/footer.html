<footer>
  <div class="text-center">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <ul class="nav nav-pills nav-justified">
            <li><a href="/">A project of #DataSF</a>
            </li>
            <li><a href="#">About</a>
            </li>
            <li><a href="#">Something here</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>


<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.3.5/tabletop.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="{{site.baseurl}}/js/c3.js"></script>
<script>
window.onload = function() {
  init()
};

var dataURL = '{{page.data}}';

function init() {
  if (dataURL.indexOf("google") > -1) {
    Tabletop.init({
      key: dataURL,
      callback: showInfo,
      simpleSheet: true
    })
  } else {
    generateChart(dataURL);
  }
}

function showInfo(data, tabletop) {
  //Step 1: connect to data and transform to array of rows or columns
  //template: specify column headers in meta data or pull them somehow from data (this is possible via Socrata)
  var sheetName = tabletop.foundSheetNames[0];
  var d = [
    ['Decade', 'Population', 'Housing Units']
  ].concat(tabletop.sheets(sheetName).toArray());

  /*
      var transpose = d[0].map(function(col, i) { 
        return d.map(function(row) {
          return row[i] 
        });
      });*/

  //Step 2: clean up data as needed (strings to numbers, empty strings to null)
  $.each(d, function(i, row) {
    $.each(row, function(i, val) {
      row[i] = parseInt(val.replace(',', '')) ? parseInt(val.replace(',', '')) : val;
      row[i] = row[i] == '' ? null : row[i];
    })
  });

  //Step 3: connect data to visualization (chart)
  //
  /*
      var chart = c3.generate({
        data: {
            // another meta data field or could be inferred from first column (preferred)
            x: 'Decade',
            rows: d,
            //type could be another variable in meta data
            types: {
              'Population': 'area',
              'Housing Units': 'area'
            }
        }
      });
*/
  var chart = c3.generate({
    data: {
      x: 'PROPUSE',
      url: 'https://data.sfgov.org/api/views/anu2-prcx/rows.csv?accessType=DOWNLOAD',
      type: 'bar'
    },
    axis: {
      x: {
        type: 'category'
      }
    }
  });
}

function generateChart(data) {
  var type = '{{page.type}}';
  var axisType = '{{page.axisType}}';
  var yFormat = '{{page.yFormat}}';
  if (type == '') {
    type = 'area';
  }
  if (yFormat != '') {
    yFormat = d3.format(yFormat)
  }

  var chart = c3.generate({
    data: {
      x: '{{page.x}}',
      url: '{{site.url}}/data/' + data,
      type: type
    },
    axis: {
      x: {
        type: axisType
      },
      y: {
        tick: {
          format: yFormat
        }
      }
    }
  });
}
</script>